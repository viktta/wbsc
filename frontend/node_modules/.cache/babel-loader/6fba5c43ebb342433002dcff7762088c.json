{"ast":null,"code":"var pathGetter = require('./path-getter');\n\nvar utils = require('./utils');\n\nvar WMap = typeof WeakMap !== 'undefined' ? WeakMap : function () {\n  var keys = [];\n  var values = [];\n  return {\n    set: function (key, value) {\n      keys.push(key);\n      values.push(value);\n    },\n    get: function (key) {\n      for (var i = 0; i < keys.length; i++) {\n        if (keys[i] === key) {\n          return values[i];\n        }\n      }\n    }\n  };\n}; // Based on https://github.com/douglascrockford/JSON-js/blob/master/cycle.js\n\nexports.decycle = function decycle(object, options, replacer) {\n  'use strict';\n\n  var map = new WMap();\n  var noCircularOption = !Object.prototype.hasOwnProperty.call(options, 'circular');\n  var withRefs = options.refs !== false;\n  return function derez(_value, path, key) {\n    // The derez recurses through the object, producing the deep copy.\n    var i, // The loop counter\n    name, // Property name\n    nu; // The new object or array\n    // typeof null === 'object', so go on if this value is really an object but not\n    // one of the weird builtin objects.\n\n    var value = typeof replacer === 'function' ? replacer(key || '', _value) : _value;\n\n    if (options.date && value instanceof Date) {\n      return {\n        $jsan: 'd' + value.getTime()\n      };\n    }\n\n    if (options.regex && value instanceof RegExp) {\n      return {\n        $jsan: 'r' + utils.getRegexFlags(value) + ',' + value.source\n      };\n    }\n\n    if (options['function'] && typeof value === 'function') {\n      return {\n        $jsan: 'f' + utils.stringifyFunction(value, options['function'])\n      };\n    }\n\n    if (options['nan'] && typeof value === 'number' && isNaN(value)) {\n      return {\n        $jsan: 'n'\n      };\n    }\n\n    if (options['infinity']) {\n      if (Number.POSITIVE_INFINITY === value) return {\n        $jsan: 'i'\n      };\n      if (Number.NEGATIVE_INFINITY === value) return {\n        $jsan: 'y'\n      };\n    }\n\n    if (options['undefined'] && value === undefined) {\n      return {\n        $jsan: 'u'\n      };\n    }\n\n    if (options['error'] && value instanceof Error) {\n      return {\n        $jsan: 'e' + value.message\n      };\n    }\n\n    if (options['symbol'] && typeof value === 'symbol') {\n      var symbolKey = Symbol.keyFor(value);\n\n      if (symbolKey !== undefined) {\n        return {\n          $jsan: 'g' + symbolKey\n        };\n      } // 'Symbol(foo)'.slice(7, -1) === 'foo'\n\n\n      return {\n        $jsan: 's' + value.toString().slice(7, -1)\n      };\n    }\n\n    if (options['map'] && typeof Map === 'function' && value instanceof Map && typeof Array.from === 'function') {\n      return {\n        $jsan: 'm' + JSON.stringify(decycle(Array.from(value), options, replacer))\n      };\n    }\n\n    if (options['set'] && typeof Set === 'function' && value instanceof Set && typeof Array.from === 'function') {\n      return {\n        $jsan: 'l' + JSON.stringify(decycle(Array.from(value), options, replacer))\n      };\n    }\n\n    if (value && typeof value.toJSON === 'function') {\n      try {\n        value = value.toJSON(key);\n      } catch (error) {\n        var keyString = key || '$';\n        return \"toJSON failed for '\" + (map.get(value) || keyString) + \"'\";\n      }\n    }\n\n    if (typeof value === 'object' && value !== null && !(value instanceof Boolean) && !(value instanceof Date) && !(value instanceof Number) && !(value instanceof RegExp) && !(value instanceof String) && !(typeof value === 'symbol') && !(value instanceof Error)) {\n      // If the value is an object or array, look to see if we have already\n      // encountered it. If so, return a $ref/path object.\n      if (typeof value === 'object') {\n        var foundPath = map.get(value);\n\n        if (foundPath) {\n          if (noCircularOption && withRefs) {\n            return {\n              $jsan: foundPath\n            };\n          }\n\n          if (path.indexOf(foundPath) === 0) {\n            if (!noCircularOption) {\n              return typeof options.circular === 'function' ? options.circular(value, path, foundPath) : options.circular;\n            }\n\n            return {\n              $jsan: foundPath\n            };\n          }\n\n          if (withRefs) return {\n            $jsan: foundPath\n          };\n        }\n\n        map.set(value, path);\n      } // If it is an array, replicate the array.\n\n\n      if (Object.prototype.toString.apply(value) === '[object Array]') {\n        nu = [];\n\n        for (i = 0; i < value.length; i += 1) {\n          nu[i] = derez(value[i], path + '[' + i + ']', i);\n        }\n      } else {\n        // If it is an object, replicate the object.\n        nu = {};\n\n        for (name in value) {\n          if (Object.prototype.hasOwnProperty.call(value, name)) {\n            var nextPath = /^\\w+$/.test(name) ? '.' + name : '[' + JSON.stringify(name) + ']';\n            nu[name] = name === '$jsan' ? [derez(value[name], path + nextPath)] : derez(value[name], path + nextPath, name);\n          }\n        }\n      }\n\n      return nu;\n    }\n\n    return value;\n  }(object, '$');\n};\n\nexports.retrocycle = function retrocycle($) {\n  'use strict';\n\n  return function rez(value) {\n    // The rez function walks recursively through the object looking for $jsan\n    // properties. When it finds one that has a value that is a path, then it\n    // replaces the $jsan object with a reference to the value that is found by\n    // the path.\n    var i, item, name, path;\n\n    if (value && typeof value === 'object') {\n      if (Object.prototype.toString.apply(value) === '[object Array]') {\n        for (i = 0; i < value.length; i += 1) {\n          item = value[i];\n\n          if (item && typeof item === 'object') {\n            if (item.$jsan) {\n              value[i] = utils.restore(item.$jsan, $);\n            } else {\n              rez(item);\n            }\n          }\n        }\n      } else {\n        for (name in value) {\n          // base case passed raw object\n          if (typeof value[name] === 'string' && name === '$jsan') {\n            return utils.restore(value.$jsan, $);\n            break;\n          } else {\n            if (name === '$jsan') {\n              value[name] = value[name][0];\n            }\n\n            if (typeof value[name] === 'object') {\n              item = value[name];\n\n              if (item && typeof item === 'object') {\n                if (item.$jsan) {\n                  value[name] = utils.restore(item.$jsan, $);\n                } else {\n                  rez(item);\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return value;\n  }($);\n};","map":{"version":3,"sources":["C:/Users/aleor/Desktop/Code/wbsc/frontend/node_modules/jsan/lib/cycle.js"],"names":["pathGetter","require","utils","WMap","WeakMap","keys","values","set","key","value","push","get","i","length","exports","decycle","object","options","replacer","map","noCircularOption","Object","prototype","hasOwnProperty","call","withRefs","refs","derez","_value","path","name","nu","date","Date","$jsan","getTime","regex","RegExp","getRegexFlags","source","stringifyFunction","isNaN","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","undefined","Error","message","symbolKey","Symbol","keyFor","toString","slice","Map","Array","from","JSON","stringify","Set","toJSON","error","keyString","Boolean","String","foundPath","indexOf","circular","apply","nextPath","test","retrocycle","$","rez","item","restore"],"mappings":"AAAA,IAAIA,UAAU,GAAGC,OAAO,CAAC,eAAD,CAAxB;;AACA,IAAIC,KAAK,GAAGD,OAAO,CAAC,SAAD,CAAnB;;AAEA,IAAIE,IAAI,GAAG,OAAOC,OAAP,KAAmB,WAAnB,GACTA,OADS,GAET,YAAW;AACT,MAAIC,IAAI,GAAG,EAAX;AACA,MAAIC,MAAM,GAAG,EAAb;AACA,SAAO;AACLC,IAAAA,GAAG,EAAE,UAASC,GAAT,EAAcC,KAAd,EAAqB;AACxBJ,MAAAA,IAAI,CAACK,IAAL,CAAUF,GAAV;AACAF,MAAAA,MAAM,CAACI,IAAP,CAAYD,KAAZ;AACD,KAJI;AAKLE,IAAAA,GAAG,EAAE,UAASH,GAAT,EAAc;AACjB,WAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,IAAI,CAACQ,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;AACpC,YAAIP,IAAI,CAACO,CAAD,CAAJ,KAAYJ,GAAhB,EAAqB;AACnB,iBAAOF,MAAM,CAACM,CAAD,CAAb;AACD;AACF;AACF;AAXI,GAAP;AAaD,CAlBH,C,CAoBA;;AAEAE,OAAO,CAACC,OAAR,GAAkB,SAASA,OAAT,CAAiBC,MAAjB,EAAyBC,OAAzB,EAAkCC,QAAlC,EAA4C;AAC5D;;AAEA,MAAIC,GAAG,GAAG,IAAIhB,IAAJ,EAAV;AAEA,MAAIiB,gBAAgB,GAAG,CAACC,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCP,OAArC,EAA8C,UAA9C,CAAxB;AACA,MAAIQ,QAAQ,GAAGR,OAAO,CAACS,IAAR,KAAiB,KAAhC;AAEA,SAAQ,SAASC,KAAT,CAAeC,MAAf,EAAuBC,IAAvB,EAA6BrB,GAA7B,EAAkC;AAExC;AAEA,QAAII,CAAJ,EAAc;AACZkB,IAAAA,IADF,EACc;AACZC,IAAAA,EAFF,CAJwC,CAM1B;AAEd;AACA;;AAEA,QAAItB,KAAK,GAAG,OAAOS,QAAP,KAAoB,UAApB,GAAiCA,QAAQ,CAACV,GAAG,IAAI,EAAR,EAAYoB,MAAZ,CAAzC,GAA+DA,MAA3E;;AAEA,QAAIX,OAAO,CAACe,IAAR,IAAgBvB,KAAK,YAAYwB,IAArC,EAA2C;AACzC,aAAO;AAACC,QAAAA,KAAK,EAAE,MAAMzB,KAAK,CAAC0B,OAAN;AAAd,OAAP;AACD;;AACD,QAAIlB,OAAO,CAACmB,KAAR,IAAiB3B,KAAK,YAAY4B,MAAtC,EAA8C;AAC5C,aAAO;AAACH,QAAAA,KAAK,EAAE,MAAMhC,KAAK,CAACoC,aAAN,CAAoB7B,KAApB,CAAN,GAAmC,GAAnC,GAAyCA,KAAK,CAAC8B;AAAvD,OAAP;AACD;;AACD,QAAItB,OAAO,CAAC,UAAD,CAAP,IAAuB,OAAOR,KAAP,KAAiB,UAA5C,EAAwD;AACtD,aAAO;AAACyB,QAAAA,KAAK,EAAE,MAAMhC,KAAK,CAACsC,iBAAN,CAAwB/B,KAAxB,EAA+BQ,OAAO,CAAC,UAAD,CAAtC;AAAd,OAAP;AACD;;AACD,QAAIA,OAAO,CAAC,KAAD,CAAP,IAAkB,OAAOR,KAAP,KAAiB,QAAnC,IAA+CgC,KAAK,CAAChC,KAAD,CAAxD,EAAiE;AAC/D,aAAO;AAACyB,QAAAA,KAAK,EAAE;AAAR,OAAP;AACD;;AACD,QAAIjB,OAAO,CAAC,UAAD,CAAX,EAAyB;AACvB,UAAIyB,MAAM,CAACC,iBAAP,KAA6BlC,KAAjC,EAAwC,OAAO;AAACyB,QAAAA,KAAK,EAAE;AAAR,OAAP;AACxC,UAAIQ,MAAM,CAACE,iBAAP,KAA6BnC,KAAjC,EAAwC,OAAO;AAACyB,QAAAA,KAAK,EAAE;AAAR,OAAP;AACzC;;AACD,QAAIjB,OAAO,CAAC,WAAD,CAAP,IAAwBR,KAAK,KAAKoC,SAAtC,EAAiD;AAC/C,aAAO;AAACX,QAAAA,KAAK,EAAE;AAAR,OAAP;AACD;;AACD,QAAIjB,OAAO,CAAC,OAAD,CAAP,IAAoBR,KAAK,YAAYqC,KAAzC,EAAgD;AAC9C,aAAO;AAACZ,QAAAA,KAAK,EAAE,MAAMzB,KAAK,CAACsC;AAApB,OAAP;AACD;;AACD,QAAI9B,OAAO,CAAC,QAAD,CAAP,IAAqB,OAAOR,KAAP,KAAiB,QAA1C,EAAoD;AAClD,UAAIuC,SAAS,GAAGC,MAAM,CAACC,MAAP,CAAczC,KAAd,CAAhB;;AACA,UAAIuC,SAAS,KAAKH,SAAlB,EAA6B;AAC3B,eAAO;AAACX,UAAAA,KAAK,EAAE,MAAMc;AAAd,SAAP;AACD,OAJiD,CAMlD;;;AACA,aAAO;AAACd,QAAAA,KAAK,EAAE,MAAMzB,KAAK,CAAC0C,QAAN,GAAiBC,KAAjB,CAAuB,CAAvB,EAA0B,CAAC,CAA3B;AAAd,OAAP;AACD;;AAED,QAAInC,OAAO,CAAC,KAAD,CAAP,IAAkB,OAAOoC,GAAP,KAAe,UAAjC,IAA+C5C,KAAK,YAAY4C,GAAhE,IAAuE,OAAOC,KAAK,CAACC,IAAb,KAAsB,UAAjG,EAA6G;AAC3G,aAAO;AAACrB,QAAAA,KAAK,EAAE,MAAMsB,IAAI,CAACC,SAAL,CAAe1C,OAAO,CAACuC,KAAK,CAACC,IAAN,CAAW9C,KAAX,CAAD,EAAoBQ,OAApB,EAA6BC,QAA7B,CAAtB;AAAd,OAAP;AACD;;AAED,QAAID,OAAO,CAAC,KAAD,CAAP,IAAkB,OAAOyC,GAAP,KAAe,UAAjC,IAA+CjD,KAAK,YAAYiD,GAAhE,IAAuE,OAAOJ,KAAK,CAACC,IAAb,KAAsB,UAAjG,EAA6G;AAC3G,aAAO;AAACrB,QAAAA,KAAK,EAAE,MAAMsB,IAAI,CAACC,SAAL,CAAe1C,OAAO,CAACuC,KAAK,CAACC,IAAN,CAAW9C,KAAX,CAAD,EAAoBQ,OAApB,EAA6BC,QAA7B,CAAtB;AAAd,OAAP;AACD;;AAED,QAAIT,KAAK,IAAI,OAAOA,KAAK,CAACkD,MAAb,KAAwB,UAArC,EAAiD;AAC/C,UAAI;AACFlD,QAAAA,KAAK,GAAGA,KAAK,CAACkD,MAAN,CAAanD,GAAb,CAAR;AACD,OAFD,CAEE,OAAOoD,KAAP,EAAc;AACd,YAAIC,SAAS,GAAIrD,GAAG,IAAI,GAAxB;AACA,eAAO,yBAAyBW,GAAG,CAACR,GAAJ,CAAQF,KAAR,KAAkBoD,SAA3C,IAAwD,GAA/D;AACD;AACF;;AAED,QAAI,OAAOpD,KAAP,KAAiB,QAAjB,IAA6BA,KAAK,KAAK,IAAvC,IACF,EAAEA,KAAK,YAAYqD,OAAnB,CADE,IAEF,EAAErD,KAAK,YAAYwB,IAAnB,CAFE,IAGF,EAAExB,KAAK,YAAYiC,MAAnB,CAHE,IAIF,EAAEjC,KAAK,YAAY4B,MAAnB,CAJE,IAKF,EAAE5B,KAAK,YAAYsD,MAAnB,CALE,IAMF,EAAE,OAAOtD,KAAP,KAAiB,QAAnB,CANE,IAOF,EAAEA,KAAK,YAAYqC,KAAnB,CAPF,EAO6B;AAEzB;AACA;AAEF,UAAI,OAAOrC,KAAP,KAAiB,QAArB,EAA+B;AAC7B,YAAIuD,SAAS,GAAG7C,GAAG,CAACR,GAAJ,CAAQF,KAAR,CAAhB;;AACA,YAAIuD,SAAJ,EAAe;AACb,cAAI5C,gBAAgB,IAAIK,QAAxB,EAAkC;AAChC,mBAAO;AAACS,cAAAA,KAAK,EAAE8B;AAAR,aAAP;AACD;;AACD,cAAInC,IAAI,CAACoC,OAAL,CAAaD,SAAb,MAA4B,CAAhC,EAAmC;AACjC,gBAAI,CAAC5C,gBAAL,EAAuB;AACrB,qBAAO,OAAOH,OAAO,CAACiD,QAAf,KAA4B,UAA5B,GACPjD,OAAO,CAACiD,QAAR,CAAiBzD,KAAjB,EAAwBoB,IAAxB,EAA8BmC,SAA9B,CADO,GAEP/C,OAAO,CAACiD,QAFR;AAGD;;AACD,mBAAO;AAAChC,cAAAA,KAAK,EAAE8B;AAAR,aAAP;AACD;;AACD,cAAIvC,QAAJ,EAAc,OAAO;AAACS,YAAAA,KAAK,EAAE8B;AAAR,WAAP;AACf;;AACD7C,QAAAA,GAAG,CAACZ,GAAJ,CAAQE,KAAR,EAAeoB,IAAf;AACD,OAtB0B,CAyB3B;;;AAEA,UAAIR,MAAM,CAACC,SAAP,CAAiB6B,QAAjB,CAA0BgB,KAA1B,CAAgC1D,KAAhC,MAA2C,gBAA/C,EAAiE;AAC7DsB,QAAAA,EAAE,GAAG,EAAL;;AACA,aAAKnB,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGH,KAAK,CAACI,MAAtB,EAA8BD,CAAC,IAAI,CAAnC,EAAsC;AAClCmB,UAAAA,EAAE,CAACnB,CAAD,CAAF,GAAQe,KAAK,CAAClB,KAAK,CAACG,CAAD,CAAN,EAAWiB,IAAI,GAAG,GAAP,GAAajB,CAAb,GAAiB,GAA5B,EAAiCA,CAAjC,CAAb;AACH;AACJ,OALD,MAKO;AAEL;AAEAmB,QAAAA,EAAE,GAAG,EAAL;;AACA,aAAKD,IAAL,IAAarB,KAAb,EAAoB;AAClB,cAAIY,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCf,KAArC,EAA4CqB,IAA5C,CAAJ,EAAuD;AACrD,gBAAIsC,QAAQ,GAAG,QAAQC,IAAR,CAAavC,IAAb,IACb,MAAMA,IADO,GAEb,MAAM0B,IAAI,CAACC,SAAL,CAAe3B,IAAf,CAAN,GAA6B,GAF/B;AAGAC,YAAAA,EAAE,CAACD,IAAD,CAAF,GAAWA,IAAI,KAAK,OAAT,GAAmB,CAACH,KAAK,CAAClB,KAAK,CAACqB,IAAD,CAAN,EAAcD,IAAI,GAAGuC,QAArB,CAAN,CAAnB,GAA2DzC,KAAK,CAAClB,KAAK,CAACqB,IAAD,CAAN,EAAcD,IAAI,GAAGuC,QAArB,EAA+BtC,IAA/B,CAA3E;AACD;AACF;AACF;;AACD,aAAOC,EAAP;AACD;;AACD,WAAOtB,KAAP;AACD,GAtHO,CAsHNO,MAtHM,EAsHE,GAtHF,CAAR;AAuHD,CA/HD;;AAkIAF,OAAO,CAACwD,UAAR,GAAqB,SAASA,UAAT,CAAoBC,CAApB,EAAuB;AAC1C;;AAGA,SAAQ,SAASC,GAAT,CAAa/D,KAAb,EAAoB;AAE1B;AACA;AACA;AACA;AAEA,QAAIG,CAAJ,EAAO6D,IAAP,EAAa3C,IAAb,EAAmBD,IAAnB;;AAEA,QAAIpB,KAAK,IAAI,OAAOA,KAAP,KAAiB,QAA9B,EAAwC;AACtC,UAAIY,MAAM,CAACC,SAAP,CAAiB6B,QAAjB,CAA0BgB,KAA1B,CAAgC1D,KAAhC,MAA2C,gBAA/C,EAAiE;AAC/D,aAAKG,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGH,KAAK,CAACI,MAAtB,EAA8BD,CAAC,IAAI,CAAnC,EAAsC;AACpC6D,UAAAA,IAAI,GAAGhE,KAAK,CAACG,CAAD,CAAZ;;AACA,cAAI6D,IAAI,IAAI,OAAOA,IAAP,KAAgB,QAA5B,EAAsC;AACpC,gBAAIA,IAAI,CAACvC,KAAT,EAAgB;AACdzB,cAAAA,KAAK,CAACG,CAAD,CAAL,GAAWV,KAAK,CAACwE,OAAN,CAAcD,IAAI,CAACvC,KAAnB,EAA0BqC,CAA1B,CAAX;AACD,aAFD,MAEO;AACLC,cAAAA,GAAG,CAACC,IAAD,CAAH;AACD;AACF;AACF;AACF,OAXD,MAWO;AACL,aAAK3C,IAAL,IAAarB,KAAb,EAAoB;AAClB;AACA,cAAG,OAAOA,KAAK,CAACqB,IAAD,CAAZ,KAAuB,QAAvB,IAAmCA,IAAI,KAAK,OAA/C,EAAuD;AACrD,mBAAO5B,KAAK,CAACwE,OAAN,CAAcjE,KAAK,CAACyB,KAApB,EAA2BqC,CAA3B,CAAP;AACA;AACD,WAHD,MAIK;AACH,gBAAIzC,IAAI,KAAK,OAAb,EAAsB;AACpBrB,cAAAA,KAAK,CAACqB,IAAD,CAAL,GAAcrB,KAAK,CAACqB,IAAD,CAAL,CAAY,CAAZ,CAAd;AACD;;AACD,gBAAI,OAAOrB,KAAK,CAACqB,IAAD,CAAZ,KAAuB,QAA3B,EAAqC;AACnC2C,cAAAA,IAAI,GAAGhE,KAAK,CAACqB,IAAD,CAAZ;;AACA,kBAAI2C,IAAI,IAAI,OAAOA,IAAP,KAAgB,QAA5B,EAAsC;AACpC,oBAAIA,IAAI,CAACvC,KAAT,EAAgB;AACdzB,kBAAAA,KAAK,CAACqB,IAAD,CAAL,GAAc5B,KAAK,CAACwE,OAAN,CAAcD,IAAI,CAACvC,KAAnB,EAA0BqC,CAA1B,CAAd;AACD,iBAFD,MAEO;AACLC,kBAAAA,GAAG,CAACC,IAAD,CAAH;AACD;AACF;AACF;AACF;AACF;AACF;AACF;;AACD,WAAOhE,KAAP;AACD,GA/CO,CA+CN8D,CA/CM,CAAR;AAgDD,CApDD","sourcesContent":["var pathGetter = require('./path-getter');\nvar utils = require('./utils');\n\nvar WMap = typeof WeakMap !== 'undefined'?\n  WeakMap:\n  function() {\n    var keys = [];\n    var values = [];\n    return {\n      set: function(key, value) {\n        keys.push(key);\n        values.push(value);\n      },\n      get: function(key) {\n        for (var i = 0; i < keys.length; i++) {\n          if (keys[i] === key) {\n            return values[i];\n          }\n        }\n      }\n    }\n  };\n\n// Based on https://github.com/douglascrockford/JSON-js/blob/master/cycle.js\n\nexports.decycle = function decycle(object, options, replacer) {\n  'use strict';\n\n  var map = new WMap()\n\n  var noCircularOption = !Object.prototype.hasOwnProperty.call(options, 'circular');\n  var withRefs = options.refs !== false;\n\n  return (function derez(_value, path, key) {\n\n    // The derez recurses through the object, producing the deep copy.\n\n    var i,        // The loop counter\n      name,       // Property name\n      nu;         // The new object or array\n\n    // typeof null === 'object', so go on if this value is really an object but not\n    // one of the weird builtin objects.\n\n    var value = typeof replacer === 'function' ? replacer(key || '', _value) : _value;\n\n    if (options.date && value instanceof Date) {\n      return {$jsan: 'd' + value.getTime()};\n    }\n    if (options.regex && value instanceof RegExp) {\n      return {$jsan: 'r' + utils.getRegexFlags(value) + ',' + value.source};\n    }\n    if (options['function'] && typeof value === 'function') {\n      return {$jsan: 'f' + utils.stringifyFunction(value, options['function'])}\n    }\n    if (options['nan'] && typeof value === 'number' && isNaN(value)) {\n      return {$jsan: 'n'}\n    }\n    if (options['infinity']) {\n      if (Number.POSITIVE_INFINITY === value) return {$jsan: 'i'}\n      if (Number.NEGATIVE_INFINITY === value) return {$jsan: 'y'}\n    }\n    if (options['undefined'] && value === undefined) {\n      return {$jsan: 'u'}\n    }\n    if (options['error'] && value instanceof Error) {\n      return {$jsan: 'e' + value.message}\n    }\n    if (options['symbol'] && typeof value === 'symbol') {\n      var symbolKey = Symbol.keyFor(value)\n      if (symbolKey !== undefined) {\n        return {$jsan: 'g' + symbolKey}\n      }\n\n      // 'Symbol(foo)'.slice(7, -1) === 'foo'\n      return {$jsan: 's' + value.toString().slice(7, -1)}\n    }\n\n    if (options['map'] && typeof Map === 'function' && value instanceof Map && typeof Array.from === 'function') {\n      return {$jsan: 'm' + JSON.stringify(decycle(Array.from(value), options, replacer))}\n    }\n\n    if (options['set'] && typeof Set === 'function' && value instanceof Set && typeof Array.from === 'function') {\n      return {$jsan: 'l' + JSON.stringify(decycle(Array.from(value), options, replacer))}\n    }\n\n    if (value && typeof value.toJSON === 'function') {\n      try {\n        value = value.toJSON(key);\n      } catch (error) {\n        var keyString = (key || '$');\n        return \"toJSON failed for '\" + (map.get(value) || keyString) + \"'\";\n      }\n    }\n\n    if (typeof value === 'object' && value !== null &&\n      !(value instanceof Boolean) &&\n      !(value instanceof Date)    &&\n      !(value instanceof Number)  &&\n      !(value instanceof RegExp)  &&\n      !(value instanceof String)  &&\n      !(typeof value === 'symbol')  &&\n      !(value instanceof Error)) {\n\n        // If the value is an object or array, look to see if we have already\n        // encountered it. If so, return a $ref/path object.\n\n      if (typeof value === 'object') {\n        var foundPath = map.get(value);\n        if (foundPath) {\n          if (noCircularOption && withRefs) {\n            return {$jsan: foundPath};\n          }\n          if (path.indexOf(foundPath) === 0) {\n            if (!noCircularOption) {\n              return typeof options.circular === 'function'?\n              options.circular(value, path, foundPath):\n              options.circular;\n            }\n            return {$jsan: foundPath};\n          }\n          if (withRefs) return {$jsan: foundPath};\n        }\n        map.set(value, path);\n      }\n\n\n      // If it is an array, replicate the array.\n\n      if (Object.prototype.toString.apply(value) === '[object Array]') {\n          nu = [];\n          for (i = 0; i < value.length; i += 1) {\n              nu[i] = derez(value[i], path + '[' + i + ']', i);\n          }\n      } else {\n\n        // If it is an object, replicate the object.\n\n        nu = {};\n        for (name in value) {\n          if (Object.prototype.hasOwnProperty.call(value, name)) {\n            var nextPath = /^\\w+$/.test(name) ?\n              '.' + name :\n              '[' + JSON.stringify(name) + ']';\n            nu[name] = name === '$jsan' ? [derez(value[name], path + nextPath)] : derez(value[name], path + nextPath, name);\n          }\n        }\n      }\n      return nu;\n    }\n    return value;\n  }(object, '$'));\n};\n\n\nexports.retrocycle = function retrocycle($) {\n  'use strict';\n\n\n  return (function rez(value) {\n\n    // The rez function walks recursively through the object looking for $jsan\n    // properties. When it finds one that has a value that is a path, then it\n    // replaces the $jsan object with a reference to the value that is found by\n    // the path.\n\n    var i, item, name, path;\n\n    if (value && typeof value === 'object') {\n      if (Object.prototype.toString.apply(value) === '[object Array]') {\n        for (i = 0; i < value.length; i += 1) {\n          item = value[i];\n          if (item && typeof item === 'object') {\n            if (item.$jsan) {\n              value[i] = utils.restore(item.$jsan, $);\n            } else {\n              rez(item);\n            }\n          }\n        }\n      } else {\n        for (name in value) {\n          // base case passed raw object\n          if(typeof value[name] === 'string' && name === '$jsan'){\n            return utils.restore(value.$jsan, $);\n            break;\n          }\n          else {\n            if (name === '$jsan') {\n              value[name] = value[name][0];\n            }\n            if (typeof value[name] === 'object') {\n              item = value[name];\n              if (item && typeof item === 'object') {\n                if (item.$jsan) {\n                  value[name] = utils.restore(item.$jsan, $);\n                } else {\n                  rez(item);\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    return value;\n  }($));\n};\n"]},"metadata":{},"sourceType":"script"}